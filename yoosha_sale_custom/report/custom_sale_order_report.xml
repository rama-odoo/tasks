<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="custom_sale_order_report">
        <t t-call="yoosha_sale_custom.custom_external_layout">
            <div class="row">
                <div class="col-6 border-top border-dark">
                    <strong>OFFERED TO</strong>
                    <div class="border-top border-dark" t-field="doc.partner_id"
                         t-options="{'widget': 'contact', 'fields': ['address'], 'no_marker': true}"/>
                </div>
                <div class="col-6 border-top border-dark">
                    <strong>OFFERED BY</strong>
                    <div class="border-top border-dark" t-field="doc.user_id"/>
                    <div t-field="doc.user_id.function"/>
                    <div t-field="doc.user_id.phone"/>
                    <div>DATE :
                        <span t-field="doc.date_order"/>
                    </div>
                </div>
            </div>
            <t t-set="total_discount" t-value="0"/>
            <table class="table table-borderless">
                <thead>
                    <tr class="bg-800">
                        <th name="th_sl_no">SL No.</th>
                        <th name="th_pro_image">IMAGE</th>
                        <th name="th_description">PRODUCT DESCRIPTION</th>
                        <th name="th_notes">NOTES</th>
                        <th name="th_unit_price">UNIT PRICE</th>
                        <th name="th_qty">QTY</th>
                        <th name="th_total">TOTAL</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="sl_no" t-value="0"/>
                    <tr t-foreach="doc.order_line" t-as="line"
                        t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else ''">
                        <t t-set="total_discount"
                           t-value="total_discount + ((line.product_uom_qty * line.price_unit) * line.discount / 100)"/>
                        <t t-if="not line.display_type">
                            <td name="td_slno">
                                <t t-set="sl_no" t-value="sl_no + 1"/>
                                <span t-esc="sl_no"/>
                            </td>
                            <td class="pe-5" name="td_pro_img">
                                <span t-if="line.product_id.image_1920">
                                    <img t-att-src="image_data_uri(line.product_id.image_1920)"
                                         style="max-height: 50%;"/>
                                </span>
                            </td>
                            <td name="td_description">
                                <span t-field="line.product_template_id"/>
                                <div t-field="line.name"/>
                            </td>
                            <td name="td_x_note">
                                <span t-field="line.x_note"/>
                            </td>
                            <td name="td_price_unit">
                                <span t-field="line.price_unit"/>
                            </td>
                            <td name="td_product_uom_qty">
                                <span t-field="line.product_uom_qty"/>
                            </td>
                            <td name="td_price_subtotal">
                                <span t-field="line.price_subtotal"/>
                            </td>
                        </t>
                        <t t-if="line.display_type == 'line_section'">
                            <td name="td_section_line" colspan="99">
                                <span t-field="line.name"/>
                            </td>
                        </t>
                        <t t-if="line.display_type == 'line_note'">
                            <td name="td_note_line" colspan="99">
                                Note :
                                <span t-field="line.name"/>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
            <div class="clearfix" name="so_total_summary">
                <div id="total" class="row" name="total">
                    <table class="table table-borderless text-end">
                        <tr>
                            <td class="border-top border-bottom border-dark">Total units</td>
                            <td class="border-top border-bottom border-dark">
                                <t t-set="uom" t-value="doc.order_line.mapped('product_uom')"/>
                                <t t-foreach="uom" t-as="pro_uom">
                                    <t t-set="uom_name" t-value="0"/>
                                    <t t-foreach="doc.order_line.filtered(lambda l:l.product_uom == pro_uom)"
                                       t-as="sale_line">
                                        <t t-set="uom_name" t-value="sale_line.product_uom_qty + uom_name"/>
                                    </t>
                                    <span t-esc="uom_name"/>
                                    <span t-esc="pro_uom.name"/>
                                </t>
                            </td>
                        </tr>
                        <tr>
                            <td class="col-8">Total amount (Ex-taxes)</td>
                            <td class="col-4">
                                <span t-field="doc.amount_untaxed" class="tex-end" data-id="total_untaxed"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="border-top border-bottom border-dark col-8">Promotional discount</td>
                            <td class=" border-top border-bottom border-dark col-4">
                                <span t-esc="total_discount" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                            </td>
                        </tr>
                        <tr>
                            <td class="border-bottom border-dark col-8">Net taxable value</td>
                            <td class="border-bottom border-dark col-4">
                                <t t-set="net_total" t-value="doc.amount_untaxed - total_discount"/>
                                <span t-esc="net_total" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                            </td>
                        </tr>
                        <t t-set="tax_totals" t-value="doc.tax_totals"/>
                        <t t-foreach="tax_totals['subtotals']" t-as="subtotal">
                            <t t-set="subtotal_to_show" t-value="subtotal['name']"/>
                            <t t-foreach="tax_totals['groups_by_subtotal'][subtotal_to_show]" t-as="amount_by_group">
                                <tr>
                                    <t t-if="tax_totals['display_tax_base']">
                                        <td class="border-bottom border-dark">
                                            <span t-esc="amount_by_group['tax_group_name']"/>
                                            <span class="text-nowrap">on
                                                <t t-esc="amount_by_group['formatted_tax_group_base_amount']"/>
                                            </span>
                                        </td>
                                        <td class="border-top border-dark text-end o_price_total">
                                            <span class="text-nowrap"
                                                  t-esc="amount_by_group['formatted_tax_group_amount']"/>
                                        </td>
                                    </t>
                                    <t t-else="">
                                        <td>
                                            <span class="text-nowrap" t-esc="amount_by_group['tax_group_name']"/>
                                        </td>
                                        <td class="text-end o_price_total">
                                            <span class="text-nowrap"
                                                  t-esc="amount_by_group['formatted_tax_group_amount']"/>
                                        </td>
                                    </t>
                                </tr>
                            </t>
                        </t>
                        <!--                            <tr t-foreach="doc.order_line.invoice_lines.filtered(lambda line: line.price_subtotal)"-->
                        <!--                                t-as="lines">-->
                        <!--                                <td class="col-8">Round off</td>-->
                        <!--                                <td class="col-4" t-if="lines.is_rounding_line">-->
                        <!--                                    <span t-esc="lines.price_subtotal" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>-->
                        <!--                                </td>-->
                        <!--                            </tr>-->
                        <tr class="bg-800">
                            <td class="border-bottom border-dark col-8">GRAND TOTAL</td>
                            <td class="border-bottom border-dark col-4">
                                <span t-field="doc.amount_total" data-id="total_amount"/>
                            </td>
                            <tr class="bg-800">
                                <td colspan="2">
                                    <span t-esc="doc.currency_id.amount_to_text(doc.amount_total)"/>
                                </td>
                            </tr>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="border-3 border-bottom border-dark text-center">
                <strong>TERMS and CONDITIONS, GENERAL NOTES AND BANK ACCOUNT DETAILS</strong>
            </div>
            <div>
                <strong>Quote validity:</strong>
                <span t-field="doc.validity_date"/>
            </div>
            <div>
                <strong>Product warranty: 3 years standard warranty, check waaranty.minister.in for more details
                </strong>
            </div>
            <div>
                <strong>Payment terms:
                    <span t-field="doc.payment_term_id"/>
                </strong>
            </div>
            <div>
                <strong>Lead time: 10 days from the date of order confirmation subject to paymnet conditions</strong>
            </div>
            <div>
                <strong>Shipping terms:
                    <span t-field="doc.x_shipping_terms"/>
                </strong>
            </div>
            <div>
                <strong t-field="doc.note"/>
            </div>
            <div t-if="doc.user_id.parent_id.bank_ids" style="color:red">
                <div>
                    <strong>Bank Name :
                        <span t-esc="doc.user_id.bank_ids.bank_name"/>
                    </strong>
                    <strong>, A/C No :
                        <span t-field="doc.user_id.bank_ids.acc_number"/>
                    </strong>
                    <strong>, IFSC :
                        <span t-field="doc.user_id.bank_ids.bank_id.bic"/>
                    </strong>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-6">
                    <strong>Seller's signature</strong>
                </div>
                <div class="text-end col-6">
                    <strong>Buyer's signature</strong>
                </div>
            </div>
            <div class="text-center bg-800">
                <strong>YOU'LL LOVE TO WORK</strong>
            </div>
        </t>
    </template>

    <template id="sale_order_report">
        <t t-call="web.html_container">
            <t t-set="sale_order_report" t-value="True"/>
            <t t-foreach="docs" t-as="doc">
                <t t-call="yoosha_sale_custom.custom_sale_order_report"/>
            </t>
        </t>
    </template>

    <template id="proforma_report">
        <t t-call="web.html_container">
            <t t-set="proforma_report" t-value="True"/>
            <t t-foreach="docs" t-as="doc">
                <t t-call="yoosha_sale_custom.custom_sale_order_report"/>
            </t>
        </t>
    </template>
</odoo>